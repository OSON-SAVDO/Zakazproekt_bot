<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; }
        #scanner-container { height: 40%; position: relative; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; }
        #receipt { height: 60%; overflow-y: auto; padding: 15px; background: #fff; color: #333; border-radius: 20px 20px 0 0; }
        .item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
        .total { font-size: 22px; font-weight: bold; margin-top: 15px; color: #000; text-align: right; }
        .scan-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 10px 20px; background: #00ff00; border: none; border-radius: 5px; cursor: pointer; z-index: 100; }
    </style>
</head>
<body>
    <div id="scanner-container">
        <video id="video"></video>
        <button id="start-btn" class="scan-btn">üé• –û“í–û–ó–ò –°–ö–ê–ù–ï–†</button>
    </div>
    
    <div id="receipt">
        <h3 style="margin-top: 0;">üõí –ß–µ–∫:</h3>
        <div id="items-list"></div>
        <div class="total">“∂–ê–ú–™: <span id="total-sum">0</span> —Å–æ–º–æ–Ω”£</div>
    </div>

    <script>
        const codeReader = new ZXing.BrowserMultiFormatReader();
        let total = 0;

        document.getElementById('start-btn').addEventListener('click', function() {
            this.style.display = 'none';
            startScanning();
        });

        function startScanning() {
            codeReader.decodeFromVideoDevice(undefined, 'video', (result, err) => {
                if (result) {
                    if (navigator.vibrate) navigator.vibrate(100);
                    processScan(result.text);
                }
            });
        }

        async function processScan(code) {
            // –ú–æ –º–∞—ä–ª—É–º–æ—Ç—Ä–æ –±–∞ –±–æ—Ç –º–µ—Ñ–∏—Ä–∏—Å—Ç–µ–º, –≤–∞–ª–µ —Å–∞“≥–∏—Ñ–∞—Ä–æ –Ω–∞–º–µ–±–∞–Ω–¥–µ–º
            // –î–∞—Ä –∏–Ω “∑–æ –º–æ –±–∞ —Å–µ—Ä–≤–µ—Ä–∏ —Ö—É–¥ –∑–∞–ø—Ä–æ—Å –º–µ—Ñ–∏—Ä–∏—Å—Ç–µ–º (–∏–Ω —É—Å—É–ª–∏ AJAX –∞—Å—Ç)
            const botToken = '8560757080:AAFXJLy71LZTPKMmCiscpe1mWKmj3lC-';
            const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
            
            // –ë–∞—Ä–æ–∏ –∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ –±–æ—è–¥ —Ñ—É–Ω–∫—Å–∏—è–∏ –º–∞—Ö—Å—É—Å—Ä–æ –¥–∞—Ä main.py –∏—Å—Ç–∏—Ñ–æ–¥–∞ –±–∞—Ä–µ–º
            // –ê–º–º–æ –±–∞—Ä–æ–∏ “≥–æ–∑–∏—Ä –º–æ —Ç–∞–Ω“≥–æ –¥–∞—Ä —ç–∫—Ä–∞–Ω –Ω–∏—à–æ–Ω –º–µ–¥–∏“≥–µ–º
            Telegram.WebApp.sendData(code); 
            // –≠–∑–æ“≥: Telegram WebApp –¥–∞—Ä —Å—É—Ä–∞—Ç–∏ sendData —Å–∞“≥–∏—Ñ–∞—Ä–æ –º–µ–±–∞–Ω–¥–∞–¥.
            // –ë–∞—Ä–æ–∏ –æ–Ω –∫–∏ —Å–∞“≥–∏—Ñ–∞ –Ω–∞–±–∞–Ω–¥–∞–¥, –º–æ –±–æ—è–¥ "answerWebAppQuery"-—Ä–æ –∏—Å—Ç–∏—Ñ–æ–¥–∞ –±–∞—Ä–µ–º.
        }
    </script>
</body>
</html>
