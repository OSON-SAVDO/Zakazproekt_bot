<audio id="beep-sound" preload="auto">
    <source src="https://www.soundjay.com/button/beep-07.mp3" type="audio/mpeg">
</audio>

<script>
    const tg = window.Telegram.WebApp;
    const codeReader = new ZXing.BrowserMultiFormatReader();
    const SERVER_URL = "https://zakazproekt-bot-2.onrender.com"; 
    
    // Функсия барои садо додан
    function playBeep() {
        const sound = document.getElementById('beep-sound');
        sound.currentTime = 0; // Садоро аз аввал оғоз мекунад
        sound.play().catch(e => console.log("Садо фаъол нашуд:", e));
    }

    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('mode'); 
    let isScanning = false;

    if (mode === 'add') {
        document.getElementById('body').className = 'mode-add';
    }

    async function initCamera() {
        try {
            const videoInputDevices = await codeReader.listVideoInputDevices();
            const selectedDeviceId = videoInputDevices[videoInputDevices.length - 1].deviceId;

            codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) => {
                if (result && !isScanning) {
                    isScanning = true;
                    
                    // Садо ва Вибратсия ҳангоми сканер
                    playBeep(); 
                    if (navigator.vibrate) navigator.vibrate(100);
                    
                    if (mode === 'add') {
                        tg.sendData(result.text); 
                    } else {
                        sendToApi(result.text);
                    }
                }
            });
        } catch (e) {
            document.getElementById('status').innerText = "Хато дар камера!";
            console.error(e);
        }
    }

    // Қисми боқимондаи код (sendToApi ва ғайра) бетағйир мемонад...
</script>
